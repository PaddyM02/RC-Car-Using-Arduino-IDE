
#include <WiFi.h>               
#include <WebServer.h>        
#include <Arduino.h>            

const char* ssid     = "Paddys iPhone";
const char* password = "12345678";        

WebServer server(80);            

int motor1Pin1 = 27;          
int motor1Pin2 = 26;            
int motor2Pin1 = 33;             
int motor2Pin2 = 25;            

int headlightLED = 14;          
int leftIndicatorLED = 12;      
int rightIndicatorLED = 13;      

int buzzerPin = 15;

int thermistorPin = 34;          

const char htmlPage[] PROGMEM = R"rawliteral(
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  html, body { font-family: Arial; text-align:center; background:#ffe8b3; }
  h1 { background:#ff6f61; color:white; padding:20px; }
  .button { padding:20px 40px; font-size:24px; margin:10px; border-radius:12px; color:white; border:none; }
  .forward{background:#4CAF50;} .reverse{background:#e67e22;}
  .left{background:#3498db;} .right{background:#9b59b6;}
  .stop{background:#e74c3c;}
  .ledbtn{background:#555;}
</style>

<script>
function sendCommand(cmd){
  fetch('/' + cmd);
  document.getElementById('status').innerText = 'Command: ' + cmd;
}

function updateTemp(){
  fetch('/temperature')
    .then(response => response.text())
    .then(data => { document.getElementById('temp').innerText = data + " °C"; });
}

setInterval(updateTemp, 1000);
</script>
</head>

<body>
<h1>ESP32 Wi-Fi Car Control</h1>

<!-- Movement buttons -->
<button class="button forward" onclick="sendCommand('forward')">Forward</button><br>
<button class="button left" onclick="sendCommand('left')">Left</button>
<button class="button stop" onclick="sendCommand('stop')">Stop</button>
<button class="button right" onclick="sendCommand('right')">Right</button><br>
<button class="button reverse" onclick="sendCommand('reverse')">Reverse</button>

<!-- Dashboard LEDs -->
<h2>Dashboard LEDs</h2>
<button class="button ledbtn" onclick="sendCommand('toggleHeadlights')">Toggle Headlights</button><br>
<button class="button ledbtn" onclick="sendCommand('leftIndicator')">Left Indicator</button>
<button class="button ledbtn" onclick="sendCommand('rightIndicator')">Right Indicator</button>

<!-- Temperature display -->
<h2>Temperature</h2>
<p id="temp">-- °C</p>

<p id="status">Ready</p>

</body>
</html>
)rawliteral";

bool headlightsOn = false;         
bool leftOn = false;               
bool rightOn = false;              



void hornBeep() {
  tone(buzzerPin, 3000); // 3kHz beep
  delay(200);
  noTone(buzzerPin);
}

void forward() {
  digitalWrite(motor1Pin1, HIGH);  
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, HIGH); 
  digitalWrite(motor2Pin2, LOW);
}

void reverse() {
  digitalWrite(motor1Pin1, LOW);   
  digitalWrite(motor1Pin2, HIGH);
  digitalWrite(motor2Pin1, LOW);   
  digitalWrite(motor2Pin2, HIGH);
}

void leftTurn() {
  digitalWrite(motor1Pin1, LOW);  
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, HIGH);  
  digitalWrite(motor2Pin2, LOW);
}

void rightTurn() {
  digitalWrite(motor1Pin1, HIGH);  
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, LOW);   
  digitalWrite(motor2Pin2, LOW);
}

void stopCar() {
  digitalWrite(motor1Pin1, LOW);   
  digitalWrite(motor1Pin2, LOW);
  digitalWrite(motor2Pin1, LOW);
  digitalWrite(motor2Pin2, LOW);
}

void toggleHeadlights() {
  headlightsOn = !headlightsOn;                          
  digitalWrite(headlightLED, headlightsOn ? HIGH : LOW); 
}

void toggleLeftIndicator() {
  leftOn = !leftOn;
  digitalWrite(leftIndicatorLED, leftOn ? HIGH : LOW);  
}

void toggleRightIndicator() {
  rightOn = !rightOn;
  digitalWrite(rightIndicatorLED, rightOn ? HIGH : LOW); 
}
  pinMode(buzzerPin, OUTPUT);
  digitalWrite(buzzerPin, LOW);

float readTemperature() {
  int adcValue = analogRead(thermistorPin);             
  float voltage = adcValue * (3.3 / 4095.0);            

  float resistance = (3.3 / voltage - 1) * 10000;        
  // Steinhart–Hart equation for thermistors
  float temperature = 1 / (0.001129148 +
                           (0.000234125 * log(resistance)) +
                           (0.0000000876741 * pow(log(resistance), 3)));

  return temperature - 273.15;                           // Kelvin → Celsius
}

void handleRoot() { server.send(200, "text/html", htmlPage); }   
void handleForward() { forward(); server.send(200); }            
void handleReverse() { reverse(); server.send(200); }            
void handleLeft() { leftTurn(); server.send(200); }             
void handleRight() { rightTurn(); server.send(200); }           
void handleStop() { stopCar(); server.send(200); }               

void handleHeadlights() { toggleHeadlights(); server.send(200); } 
void handleLeftLED() { toggleLeftIndicator(); server.send(200); } 
void handleRightLED() { toggleRightIndicator(); server.send(200); } 

void handleTemp() {
  float temp = readTemperature();                                  
  server.send(200, "text/plain", String(temp, 1));                 
}

void setup() {
  Serial.begin(115200);                                     

  pinMode(motor1Pin1, OUTPUT);
  pinMode(motor1Pin2, OUTPUT);
  pinMode(motor2Pin1, OUTPUT);
  pinMode(motor2Pin2, OUTPUT);

  pinMode(headlightLED, OUTPUT);
  pinMode(leftIndicatorLED, OUTPUT);
  pinMode(rightIndicatorLED, OUTPUT);

  stopCar();                                                      

  WiFi.begin(ssid, password);
  Serial.print("Connecting");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("\nConnected!");                               
  Serial.println(WiFi.localIP());                                 

  server.on("/", handleRoot);
  server.on("/forward", handleForward);
  server.on("/reverse", handleReverse);
  server.on("/left", handleLeft);
  server.on("/right", handleRight);
  server.on("/stop", handleStop);

  server.on("/toggleHeadlights", handleHeadlights);
  server.on("/leftIndicator", handleLeftLED);
  server.on("/rightIndicator", handleRightLED);

  server.on("/temperature", handleTemp);

  server.begin();                                                   
}

void loop() {
  server.handleClient();                                           
}
